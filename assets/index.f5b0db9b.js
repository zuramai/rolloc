var y=Object.defineProperty;var x=(t,e,r)=>e in t?y(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var c=(t,e,r)=>(x(t,typeof e!="symbol"?e+"":e,r),r);const w=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function r(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(i){if(i.ep)return;i.ep=!0;const n=r(i);fetch(i.href,n)}};w();var A=Object.defineProperty,m=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,u=(t,e,r)=>e in t?A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,d=(t,e)=>{for(var r in e||(e={}))C.call(e,r)&&u(t,r,e[r]);if(m)for(var r of m(e))b.call(e,r)&&u(t,r,e[r]);return t},v=(t,e,r)=>(u(t,typeof e!="symbol"?e+"":e,r),r),P={size:500,padding:0,anchor:{type:"line",positionAngle:100,gapFromCenter:10,length:70},rollOptions:{type:"circle",duration:5e3},items:[]},g=class{constructor(t,e){c(this,"el");c(this,"elements",{});c(this,"options");c(this,"degreeRotated",0);this.options=d(d({},P),e),this.mount(t)}resolveSelector(t){return typeof t=="string"?document.querySelector(t):t||null}mount(t){if(this.el)throw new Error("[rolloc] already mounted, unmount previous target first");let e=this.resolveSelector(t);if(!e)throw new Error("[rolloc] target element not found");this.el=s("svg",{preserveAspectRatio:"xMidYMid slice",viewBox:`0 0 ${this.options.size} ${this.options.size}`,width:this.options.size.toString(),height:this.options.size.toString()}),e.appendChild(this.el),this.draw(),console.log(this.options.items)}draw(){let t=this.getRadius(),{x:e,y:r}=this.getCenterPoint(),o=this.drawCircles(e,r,t),i=this.options.anchor,n=this.drawAnchor(i);this.appendEl("outerCircle",o.outerCircle),this.appendEl("anchor",n),this.appendEl("itemsGroup",this.drawItems()),this.appendEl("images",this.drawImages()),this.appendEl("innerCircle",o.innerCircle);let l={x:i.positionAngle>270||i.positionAngle<=90?0:100,y:i.positionAngle<180?0:100};n.style.transformOrigin=`${l.x}% ${l.y}%`,n.style.transformBox="fill-box"}drawImages(){let t=s("defs",{});return this.options.items.forEach((e,r)=>{if(!e.image)return;let o=document.querySelector("#pie-"+r).getBBox(),i=s("pattern",{id:`image-${r}`,patternUnits:"userSpaceOnUse",x:o.x,y:o.y,width:o.width,height:o.height}),n;typeof e.image=="string"?n=s("image",{"xlink:href":e.image,width:this.getRadius(),height:this.getRadius()}):e.image instanceof HTMLImageElement?n=s("image",{"xlink:href":e.image.src,width:this.getRadius(),height:this.getRadius()}):n=e.image,i.appendChild(n),t.appendChild(i)}),t}drawAnchor(t){var e,r;let o;if(t.type=="line"){let i=this.getCenterPoint(),n=this.getArcCoordinate(t.positionAngle,t.length);o=s("line",{class:"rolloc__arrow",x1:i.x,x2:n.x,y1:i.y,y2:n.y,stroke:"black"})}else if(t.type=="triangle"){let i=this.getRadius(),n=[this.getArcCoordinate(t.positionAngle-t.size/2,i),this.getArcCoordinate(t.positionAngle+t.size/2,i-40),this.getArcCoordinate(t.positionAngle+t.size,i)];console.log(n);let l=["M",n[0].x,n[0].y,"L",n[1].x,n[1].y,"L",n[2].x,n[2].y,"A",i,i,0,0,0,n[0].x,n[0].y].join(" ");o=s("path",{d:l,stroke:(e=t.stroke)!=null?e:"black",fill:(r=t.fill)!=null?r:"#3aad36",class:"rolloc__anchor"})}return o}drawCircles(t,e,r){let o=s("circle",{class:"rolloc__outer-circle",cx:t.toString(),cy:e.toString(),r:r.toString(),fill:"white"}),i=s("circle",{class:"rolloc__inner-circle",cx:t,cy:e,r:20,fill:"#ccc",stroke:"#333"});return{outerCircle:o,innerCircle:i}}drawItems(){let t=s("g",{class:"rolloc__item-group"}),e=this.options.items,r=e.length,o=this.getRadius();for(let i=0;i<r;i++){let n=s("g",{class:"rolloc__item"}),l=e[i],p=1/r*360,a={start:i*p,end:(i+1)*p};l.startAngle=a.start,l.endAngle=a.end;let h=this.drawPie(a.start,a.end,o);h.setAttribute("id","pie-"+i);let f=this.drawText(l.text,a.start,a.end,o);l.image&&h.setAttribute("fill",`url(#image-${i})`),n.appendChild(f),n.appendChild(h),t.appendChild(n)}return t}drawPie(t,e,r){let o=[this.getArcCoordinate(t,r),this.getArcCoordinate(e,r)],i=this.getPiePath(o[0],o[1]);return s("path",{d:i,class:"rolloc__pie",stroke:"black",fill:"transparent"})}drawText(t,e,r,o){let i=this.getArcCoordinate(e+(r-e)/2,o*2/3);return s("text",{x:i.x,y:i.y,"text-anchor":"middle","transform-box":"fill-box","transform-origin":"center","dominant-baseline":"middle"},t)}getRadius(){return this.options.size/2-this.options.padding*2}appendEl(t,e){this.el.appendChild(e),this.elements[t]=e}getPiePath(t,e){let{x:r,y:o}=this.getCenterPoint(),i=1/this.options.items.length*360<=180?0:1,n=this.getRadius();return`
            M${r},${o}
            L${t.x},${t.y}
            A${n},${n} 0 ${i} 1 ${e.x} ${e.y}
            L${r},${o}
            Z
        `}getCenterPoint(){return{x:this.options.size/2,y:this.options.size/2}}getArcCoordinate(t,e){e||(e=this.getRadius());let r=this.getCenterPoint(),o=t*Math.PI/180,i=e*Math.cos(o),n=e*Math.sin(o);return{x:i+r.x,y:n+r.y}}roll(t){t=d(d({},this.options.rollOptions),t);let e=this.elements.anchor,r=typeof t.duration=="object"?Math.floor(Math.random()*(t.duration.max-t.duration.min+1)+t.duration.min):~~t.duration,o=r*(Math.random()*2+1);return this.degreeRotated+=o,console.log(e),e.animate([{rotate:this.degreeRotated+"deg"}],{duration:r,fill:"forwards",easing:"cubic-bezier(0.16, 1, 0.3, 1)"}),console.log("animating"),new Promise(i=>setTimeout(()=>i(this.getResult()),r))}getResult(){let t=(this.degreeRotated+this.options.anchor.positionAngle)%360;for(let e=0;e<this.options.items.length;e++){let r=this.options.items[e];if(t>r.startAngle&&t<=r.endAngle)return r}return null}};v(g,"ns","http://www.w3.org/2000/svg");function s(t,e,r=""){let o=document.createElementNS(g.ns,t);for(let i in e)i=="xlink:href"?o.setAttributeNS("http://www.w3.org/1999/xlink","href",e[i].toString()):o.setAttributeNS(null,i,e[i].toString());return o.innerHTML=r,o}function R(t,e){return new g(t,e)}const S=R("#roller",{items:[{value:"grape",text:"Grape"},{value:"apple",text:"Apple"},{value:"orange",text:"Orange"},{value:"lemon",text:"Lemon"}],anchor:{type:"line",positionAngle:220,gapFromCenter:10,length:70}});let $=document.querySelector("button");$.addEventListener("click",t=>{t.preventDefault();let e=document.querySelector("input");S.roll({duration:~~e.value}).then(r=>{alert("success roll, result = "+r.value)})});
