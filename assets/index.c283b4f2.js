var y=Object.defineProperty;var w=(t,e,i)=>e in t?y(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var c=(t,e,i)=>(w(t,typeof e!="symbol"?e+"":e,i),i);const x=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=i(r);fetch(r.href,o)}};x();var b=Object.defineProperty,m=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable,u=(t,e,i)=>e in t?b(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,d=(t,e)=>{for(var i in e||(e={}))C.call(e,i)&&u(t,i,e[i]);if(m)for(var i of m(e))v.call(e,i)&&u(t,i,e[i]);return t},A=(t,e,i)=>(u(t,typeof e!="symbol"?e+"":e,i),i),S={size:500,padding:0,anchor:{type:"line",positionAngle:100,gapFromCenter:10,length:70},rollOptions:{type:"circle",duration:5e3},items:[]},p=class{constructor(t,e){c(this,"el");c(this,"elements",{});c(this,"options");c(this,"degreeRotated",0);this.options=d(d({},S),e),this.mount(t)}resolveSelector(t){return typeof t=="string"?document.querySelector(t):t||null}mount(t){if(this.el)throw new Error("[rolloc] already mounted, unmount previous target first");let e=this.resolveSelector(t);if(!e)throw new Error("[rolloc] target element not found");this.el=l("svg",{preserveAspectRatio:"xMidYMid slice",viewBox:`0 0 ${this.options.size} ${this.options.size}`,width:this.options.size.toString(),height:this.options.size.toString()}),e.appendChild(this.el),this.draw(),console.log(this.options.items)}draw(){let t=this.getRadius(),{x:e,y:i}=this.getCenterPoint(),n=this.drawCircles(e,i,t),r=this.options.anchor,o=this.drawAnchor(r);this.appendEl("outerCircle",n.outerCircle),this.appendEl("anchor",o),this.appendEl("itemsGroup",this.drawItems()),this.appendEl("images",this.drawImages()),this.appendEl("innerCircle",n.innerCircle);let s={x:r.positionAngle>270||r.positionAngle<=90?0:100,y:r.positionAngle<180?0:100};o.style.transformOrigin=`${s.x}% ${s.y}%`,o.style.transformBox="fill-box"}drawImages(){let t=l("defs",{});return this.options.items.forEach((e,i)=>{if(!e.image)return;let n=document.querySelector("#pie-"+i).getBBox(),r=l("pattern",{id:`image-${i}`,patternUnits:"userSpaceOnUse",x:n.x,y:n.y,width:n.width,height:n.height}),o;typeof e.image=="string"?o=l("image",{"xlink:href":e.image,width:this.getRadius(),height:this.getRadius()}):e.image instanceof HTMLImageElement?o=l("image",{"xlink:href":e.image.src,width:this.getRadius(),height:this.getRadius()}):o=e.image,r.appendChild(o),t.appendChild(r)}),t}drawAnchor(t){let e;if(t.type=="line"){let i=this.getCenterPoint(),n=this.getArcCoordinate(t.positionAngle,t.length);e=l("line",{class:"rolloc__arrow",x1:i.x,x2:n.x,y1:i.y,y2:n.y,stroke:"black"})}return e}drawCircles(t,e,i){let n=l("circle",{class:"rolloc__outer-circle",cx:t.toString(),cy:e.toString(),r:i.toString(),fill:"white"}),r=l("circle",{class:"rolloc__inner-circle",cx:t,cy:e,r:20,fill:"#ccc",stroke:"#333"});return{outerCircle:n,innerCircle:r}}drawItems(){let t=l("g",{class:"rolloc__item-group"}),e=this.options.items,i=e.length,n=this.getRadius();for(let r=0;r<i;r++){let o=l("g",{class:"rolloc__item"}),s=e[r],g=1/i*360,a={start:r*g,end:(r+1)*g};s.startAngle=a.start,s.endAngle=a.end;let h=this.drawPie(a.start,a.end,n);h.setAttribute("id","pie-"+r);let f=this.drawText(s.text,a.start,a.end,n);s.image&&h.setAttribute("fill",`url(#image-${r})`),o.appendChild(f),o.appendChild(h),t.appendChild(o)}return t}drawPie(t,e,i){let n=[this.getArcCoordinate(t,i),this.getArcCoordinate(e,i)],r=this.getPiePath(n[0],n[1]);return l("path",{d:r,class:"rolloc__pie",stroke:"black",fill:"transparent"})}drawText(t,e,i,n){let r=this.getArcCoordinate(e+(i-e)/2,n*2/3);return l("text",{x:r.x,y:r.y,"text-anchor":"middle","transform-box":"fill-box","transform-origin":"center","dominant-baseline":"middle"},t)}getRadius(){return this.options.size/2-this.options.padding*2}appendEl(t,e){this.el.appendChild(e),this.elements[t]=e}getPiePath(t,e){let{x:i,y:n}=this.getCenterPoint(),r=1/this.options.items.length*360<=180?0:1,o=this.getRadius();return`
            M${i},${n}
            L${t.x},${t.y}
            A${o},${o} 0 ${r} 1 ${e.x} ${e.y}
            L${i},${n}
            Z
        `}getCenterPoint(){return{x:this.options.size/2,y:this.options.size/2}}getArcCoordinate(t,e){e||(e=this.getRadius());let i=this.getCenterPoint(),n=t*Math.PI/180,r=e*Math.cos(n),o=e*Math.sin(n);return{x:r+i.x,y:o+i.y}}roll(t){t=d(d({},this.options.rollOptions),t);let e=this.elements.anchor,i=typeof t.duration=="object"?Math.floor(Math.random()*(t.duration.max-t.duration.min+1)+t.duration.min):~~t.duration,n=i*(Math.random()*2+1);return this.degreeRotated+=n,console.log(e),e.animate([{rotate:this.degreeRotated+"deg"}],{duration:i,fill:"forwards",easing:"cubic-bezier(0.16, 1, 0.3, 1)"}),console.log("animating"),new Promise(r=>setTimeout(()=>r(this.getResult()),i))}getResult(){let t=(this.degreeRotated+this.options.anchor.positionAngle)%360;for(let e=0;e<this.options.items.length;e++){let i=this.options.items[e];if(t>i.startAngle&&t<=i.endAngle)return i}return null}};A(p,"ns","http://www.w3.org/2000/svg");function l(t,e,i=""){let n=document.createElementNS(p.ns,t);for(let r in e)r=="xlink:href"?n.setAttributeNS("http://www.w3.org/1999/xlink","href",e[r].toString()):n.setAttributeNS(null,r,e[r].toString());return n.innerHTML=i,n}function P(t,e){return new p(t,e)}const $=P("#roller",{items:[{value:"grape",text:"Grape"},{value:"apple",text:"Apple"},{value:"orange",text:"Orange"},{value:"lemon",text:"Lemon"}],anchor:{type:"line",positionAngle:220,gapFromCenter:10,length:70}});let R=document.querySelector("button");R.addEventListener("click",t=>{t.preventDefault();let e=document.querySelector("input");$.roll({duration:~~e.value}).then(i=>{alert("success roll, result = "+i.value)})});
